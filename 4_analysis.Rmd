---
title: "DATA 607 - Project 3 - Analysis"
author: "Keith Colella"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, message=FALSE}
library(tidyverse)
library(ggplot2)
library(ggwordcloud)
```

## Read in data

Read the data from a CSV file  which containing job listings and skills

```{r message=F}
# jobs <- read_csv('output/job_listings_skills.csv')
jobs_long <- read_csv('output/job_listings_skills_long.csv')
```


Display the column names of the jobs_long

```{r}
names(jobs_long)
```


First we have to to check any missing values in the highest_ed
 
```{r}
sum(is.na(jobs_long$highest_ed))

```


## Visualizations


##### Which education level is more prevalent among different job types.

```{r}
jobs_long %>%
  na.omit() %>%
  group_by(job_id, highest_ed) %>%
  summarize(jobs = n(), .groups = 'keep') %>%
  ggplot(aes(highest_ed)) +
  geom_bar()

```

the highest bar in the plot is representing "Master.

One way to confirm this is to use the count() function to count the number of observations for each level of the highest_ed variable and arrange them in descending order


```{r}
jobs_long %>%
  na.omit() %>%
  count(highest_ed, sort = TRUE)
```

Based on the information we got, it seems that the "Master" category has the highest count with 7003 observations, followed by "PhD" with 6452 observations, and then "Bachelor" with 5585 observations.


##### maximum salaries for each job

```{r}
jobs_long %>%
  na.omit() %>%
  group_by(job_id, salary_max) %>%
  summarize(jobs = n(), .groups = 'keep') %>%
  ggplot(aes(salary_max)) +
  geom_histogram(binwidth = 20000) +
  scale_x_continuous(label = scales::comma,
                     limits = c(0,500000))

```



```{r}
ggplot(na.omit(jobs_long), aes(x = salary_max, fill = highest_ed)) +
  geom_histogram(binwidth = 20000, alpha = 0.7) +
  scale_x_continuous(label = scales::comma, limits = c(0, 500000)) +
  scale_fill_brewer(type = "qual", palette = "Set1") +
  labs(title = "Distribution of maximum salaries by highest education level",
       x = "Salary (USD)", y = "Count")

```


The histograms show the distribution of maximum salary values for each job position in the jobs_long dataset, with missing values removed.

The x-axis represents the maximum salary values, and the y-axis represents the count of jobs with those maximum salary values.

From the plots, we can see that the majority of jobs have a maximum salary value between 0 and 100000. There are relatively fewer jobs with a maximum salary value between 100000 and 200000, and even fewer with a maximum salary value between 200000 and 300000. There are only a few jobs with a maximum salary value above 300000.

##### Years of experience

```{r}
jobs_long %>%
  group_by(job_id, years_exp) %>%
  summarize(jobs = n(), .groups = 'keep') %>%
  ggplot(aes(years_exp)) +
  geom_bar()

```


```{r}
jobs_long %>%
  group_by(job_id, years_exp, highest_ed) %>%
  summarize(jobs = n(), .groups = 'keep') %>%
  filter(!is.na(highest_ed)) %>%
  ggplot(aes(years_exp, ..density..)) +
  geom_histogram(binwidth = 3) +
  facet_grid(~highest_ed,
             labeller = label_wrap_gen(width=2, multi_line=TRUE))

<<<<<<< HEAD
=======
jobs_long %>%
  group_by(job_id, salary_max, highest_ed) %>%
  summarize(jobs = n(), .groups = 'keep') %>%
  filter(!is.na(highest_ed)) %>%
  ggplot(aes(salary_max, ..density..)) +
  geom_histogram(binwidth = 20000) +
  scale_x_continuous(label = scales::comma,
                     limits = c(0,500000)) +
  theme(axis.text.x = element_text(angle=90)) +
  facet_grid(~highest_ed,
             labeller = label_wrap_gen(width=2, multi_line=TRUE))

## We need to do some cleanup on location
jobs_long %>%
  ggplot(aes(fct_rev(fct_infreq(continent)))) +
  geom_bar() +
  coord_flip()
>>>>>>> main
```


This plot shows the distribution of years of experience for different job positions and education levels. Each facet represents a different education level, with the x-axis showing the range of years of experience and the y-axis representing the density of the observations in that range.

The plot suggests that there are differences in the distribution of years of experience across different job positions and education levels. For example, among individuals with a Bachelor's degree, the distribution of years of experience appears to be skewed towards the lower end, suggesting that many individuals in these positions have relatively little experience. On the other hand, among individuals with a PhD, the distribution of years of experience appears to be more evenly spread out, suggesting that individuals with a PhD may have more varied levels of experience.


##### Most Frequently Cited Skills

```{r}
jobs_long %>%
  group_by(skills) %>%
  summarize(citations = n(), .groups = 'keep') %>%
  arrange(desc(citations)) %>%
  head(20)

for (ed_level in unique(jobs_long$highest_ed)) {
  jobs_long %>%
    filter(highest_ed == ed_level) %>%
    group_by(skills) %>%
    summarize(citations = n(),
              ed_level = ed_level,
              .groups = 'keep') %>%
    arrange(desc(citations)) %>%
    head(10) %>%
    print()
}

for (loc in c('New York', 'Remote', 'France')) {
  jobs_long %>%
    filter(location == loc) %>%
    group_by(skills) %>%
    summarize(citations = n(),
              location = loc,
              .groups = 'keep') %>%
    arrange(desc(citations)) %>%
    head(10) %>%
    print()
}
```


Group the data by the skills column and count the number of counts for each skill:

```{r}
skill_counts <- jobs_long %>%
  group_by(skills) %>%
  summarize(counts = n(), .groups = 'keep')

```


Filter out any skills that you don't want to include in the plot

```{r}
overweighted <- c("data", "analyst", "analysis", "analytics","big data","business analytics", "data")
skill_counts <- skill_counts[!grepl(paste(overweighted, collapse="|"), skill_counts$skills), ]

```


Sort the data by the number of citations in descending order and select the top 50 most cited skills

```{r}
skill_counts <- skill_counts %>%
  arrange(desc(counts)) %>%
  head(50)

```



Create the plot using ggplot2 and ggwordcloud packages

```{r}
library(ggplot2)
library(ggwordcloud)

ggplot(skill_counts, aes(label = skills, size = counts, color = factor(sample.int(8, nrow(skill_counts), replace = TRUE)))) +
  geom_text_wordcloud() +
  scale_size_area(max_size = 10) +
  theme_minimal()

```

Most frequently counted skills for job listings with at least 5 years of experience

```{r}
exp5_skill_counts <- jobs_long %>%
  filter(years_exp >= 5) %>%
  group_by(skills) %>%
  summarize(counts = n(), .groups = 'keep')

ggplot(exp5_skill_counts, aes(label = skills, size = counts, color = factor(sample.int(8, nrow(exp5_skill_counts), replace = TRUE)))) +
  geom_text_wordcloud() +
  scale_size_area(max_size = 15) +
  theme_minimal()

```

The code is creating a word cloud of skills that are required for jobs with 5 or more years of experience. The jobs_long data frame is filtered to keep only the rows where the years_exp column is greater than or equal to 5, and then grouped by the skills column.


```{r}

# Plot a word cloud of the most frequently cited skills
skills_freq <- jobs_long %>%
  count(skills) %>%
  arrange(desc(n)) %>%
  head(100)
ggplot(skills_freq, aes(label = skills, size = n)) +
  geom_text_wordcloud() +
  theme_minimal() +
  labs(title = "Most frequently cited skills")

```
This code generates a word cloud plot of the most frequently cited skills in the jobs_long dataset. It first creates a new dataframe called skills_freq that counts the frequency of each skill in the skills column of jobs_long, arranges them in descending order, and selects the top 100. It then uses ggplot and geom_text_wordcloud to plot the skill names as words, with the size of the word indicating the frequency of the skill. The plot is given a title "Most frequently cited skills


##### Number of job listings per website

```{r}

# Plot a bar chart of the number of job listings per website
ggplot(jobs_long, aes(x = website)) +
  geom_bar(fill = "steelblue") +
  coord_flip() +
  labs(title = "Number of job listings per website",
       x = "Website", y = "Count")
```



```{r}


# Plot a stacked bar chart of the number of job listings by location and highest education level
ggplot(jobs_long, aes(x = highest_ed, fill = location)) +
  geom_bar() +
  labs(title = "Number of job listings by location and highest education level",
       x = "Highest education level", y = "Count") +
  theme(legend.position = "bottom")

```

The code is generating a stacked bar chart that shows the number of job listings for each combination of location and highest education level. The x-axis represents the highest education level and the bars are stacked by location. 



**What are the top 10 most important skills for data science?**

```{r}
job_listings <- read.csv(url("https://raw.githubusercontent.com/ShanaFarber/D607_Project3/main/output/job_listings.csv"), na.strings=c(""))
  
skills <- read.csv(url("https://raw.githubusercontent.com/ShanaFarber/D607_Project3/main/output/skills.csv"))

top_10 <- skills %>%
  count(skill) %>%
  arrange(desc(n)) %>%
  head(n = 10)

knitr::kable(top_10, col.names = c("Skills", "Frequency"), format.args = list(big.mark = ","))

top_10 %>%
  ggplot(aes(y = skill, x = n, fill = skill)) +
    geom_bar(stat = "identity") +
    labs(title = "Top 10 Skills for Data Science", x = "Frequency", y = "Skill") +
    theme(legend.position = "none")
```

**What are the top skills for Data Scientists vs. Data Analysts?**

```{r fig.show='hold', out.width='50%'}
# create a full data frame with the skills
full <- job_listings %>%
  right_join(skills, by="job_id")

# filter for just data scienctists and analysts
data_scientist <- full %>% 
  filter(str_detect(job_title, "Data Scientist")) %>%
  mutate(job = "Data Scientist")
  
data_analyst <- full %>% 
  filter(str_detect(job_title, "Data Analyst")) %>%
  mutate(job = "Data Analyst")

# top 10 for each
data_scientist_top10 <- data_scientist %>%
  count(skill) %>%
  arrange(desc(n)) %>%
  head(n = 10)

data_analyst_top10 <- data_analyst %>%
  count(skill) %>%
  arrange(desc(n)) %>%
  head(n = 10)

# plot top 10
data_scientist_top10 %>%
  ggplot(aes(y = skill, x = n, fill = skill)) +
    geom_bar(stat = "identity") +
    labs(title = "Top 10 Skills for Data Scienctists", x = "Frequency", y = "Skill") +
    theme(legend.position = "none")

data_analyst_top10 %>%
  ggplot(aes(y = skill, x = n, fill = skill)) +
    geom_bar(stat = "identity") +
    labs(title = "Top 10 Skills for Data Analysts", x = "Frequency", y = "Skill") +
    theme(legend.position = "none")
```


## conclusion 

The "Master" education level is the most prevalent among different job types, followed by "PhD" and "Bachelor".
The majority of jobs have a maximum salary value between 0 and 100,000 USD. There are relatively fewer jobs with a maximum salary value between 100,000 and 200,000 USD, and even fewer with a maximum salary value between 200,000 and 300,000 USD. There are only a few jobs with a maximum salary value above 300,000 USD.
There are differences in the distribution of years of experience across different job positions and education levels. For example, among individuals with a Bachelor's degree, the distribution of years of experience appears to be skewed towards the lower end, suggesting that many individuals in these positions have relatively little experience. On the other hand, among individuals with a PhD, the distribution of years of experience appears to be more evenly spread out, suggesting that individuals with a PhD may have more varied levels of experience.
The most frequently cited skills in the job listings are "Python", "SQL", and "Machine Learning". The top skills cited in the job listings vary depending on the highest education level required and the job location.

