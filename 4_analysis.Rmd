---
title: "Visualizations"
author: "John Cruz"
date: "3-16-2022"
output: html_document
---

```{r setup, message=FALSE}
library(tidyverse)
library(ggplot2)
library(ggwordcloud)
```

## Read in data

Read the data from a CSV file which contains job listings and skills

```{r message=FALSE}
import_df <- read_csv('output/job_listings_skills_long.csv')
```

## Job Listings Based on Data Source

```{r website-count}
distinct_job_website <- 
  import_df |> 
  group_by(website) |> 
  summarise(count = n_distinct(job_id)) |> 
  arrange(desc(count))

ggplot(distinct_job_website, aes(x = count, y = reorder(website, count))) +
  geom_bar(stat = 'identity', fill = '#4E79A7') +
  labs(title = "Job Listings per Website", x = '', y = '') +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        axis.text = element_text(face = 'bold'))

knitr::kable(distinct_job_website)
```

## Most Requested Degree

Based on the job postings that had college degree information, having a Master's was first at 498, followed by a Bachelor's at 457. 

```{r college-degree}
high_degree <- 
  import_df |> 
  na.omit(highest_ed) %>%
  group_by(highest_ed) %>%
  summarize(count = n_distinct(job_id))

high_degree %>%
  ggplot(aes(x = highest_ed, y = count)) +
  geom_bar(stat = 'identity', fill = '#4E79A7') + 
  labs(title = "Most Degrees Requested", x = '', y = '') +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        axis.text = element_text(face = 'bold')) +
  geom_text(aes(label = count), 
            position = position_stack(vjust = 0.8), 
            size = 4,
            fontface = 'bold',
            color = 'white')

knitr::kable(high_degree)
```

## Maximum Salary Distribution

The histogram shows the distribution of maximum salary values for all jobs within the dataset, with missing values removed. We can see that there is a bi-modal distribution where it peaks first at \$125,000 with 1,365 jobs and again at \$175,000 with 986 jobs. 

```{r salary}
salaries <- 
  import_df |> 
  filter(!is.na(salary_max)) |> 
  distinct(job_id, .keep_all = TRUE)
  

salaries |> 
  ggplot(aes(x = salary_max)) +
  geom_histogram(binwidth = 25000, fill = '#4E79A7') +
  scale_x_continuous(labels = scales::dollar) +
  labs(title = "Maximum Salary Distribution", x = '', y = '') +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        axis.text = element_text(face = 'bold')) +
  stat_bin(binwidth=25000, geom='text', color='white', size=3,
           aes(label=after_stat(count)), position=position_stack(vjust=0.8))
```

## Maximum Salary Distribution vs. Education

Separating our bi-modal distribution based on education, we can still see the same type of distribution and peaks as before.

```{r salary-edu}
salaries_edu <- 
  import_df |> 
  filter(!is.na(salary_max), !is.na(highest_ed)) |> 
  distinct(job_id, .keep_all = TRUE)
  

salaries_edu |> 
  ggplot(aes(x = salary_max)) +
  geom_histogram(binwidth = 25000, fill = '#4E79A7') +
  scale_x_continuous(labels = scales::dollar) +
  labs(title = "Maximum Salary Distribution vs. Education", x = '', y = '') +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        axis.text = element_text(face = 'bold')) +
  stat_bin(binwidth=25000, geom='text', color='white', size=3,
           aes(label=after_stat(count)), position=position_stack(vjust=0.8)) +
  facet_grid(rows = vars(highest_ed))
```

## Maximum Salary Distribution vs. Years of Experience

Separating our bi-modal distribution based on years of experience, we again can still see the same type of distribution and peaks as before.

```{r salary-experience}
salaries_exp <- 
  import_df |> 
  filter(!is.na(salary_max), !is.na(years_exp)) |> 
  distinct(job_id, .keep_all = TRUE) |> 
  mutate(exp_bins = case_when(years_exp <= 2 ~ "0-2",
                              years_exp > 2 & years_exp <= 5 ~ "3-5",
                              years_exp > 5 & years_exp <= 8 ~ "6-8",
                              years_exp > 8  ~ "9+")) |> 
  mutate(across(c(exp_bins), factor))


salaries_exp |> 
  ggplot(aes(x = salary_max)) +
  geom_histogram(binwidth = 25000, fill = '#4E79A7') +
  scale_x_continuous(labels = scales::dollar) +
  labs(title = "Maximum Salary Distribution vs. Years of Experience", x = '', y = '') +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        axis.text = element_text(face = 'bold')) +
  stat_bin(binwidth=25000, geom='text', color='white', size=3,
           aes(label=after_stat(count)), position=position_stack(vjust=0.8)) +
  facet_grid(rows = vars(exp_bins))
```

## Education and Years of Experience

Based on the chart, we can identify that most jobs primarily look for candidates with 3-5 years of experience. However, the plot also suggests that there are differences in the distribution of years of experience within each educational level. For example, among individuals with a Bachelor's degree, the distribution of years of experience appears to be skewed towards the lower end, suggesting that many individuals in these positions have relatively little experience. On the other hand, among individuals with a PhD, the distribution of years of experience appears to be more evenly spread out, suggesting that individuals with a PhD may have more varied levels of experience.

```{r education-exp}
edu_exp <- 
  import_df |> 
  filter(!is.na(highest_ed), !is.na(years_exp)) |> 
  distinct(job_id, .keep_all = TRUE) |> 
  mutate(exp_bins = case_when(years_exp <= 2 ~ "0-2",
                              years_exp > 2 & years_exp <= 5 ~ "3-5",
                              years_exp > 5 & years_exp <= 8 ~ "6-8",
                              years_exp > 8  ~ "9+")) |> 
  mutate(across(c(exp_bins), factor))

edu_exp |> ggplot(aes(exp_bins)) +
  geom_bar(aes(fill = exp_bins)) +
  facet_grid(~highest_ed,
             labeller = label_wrap_gen(width=2, multi_line=TRUE)) +
  labs(title = "Education vs. Years of Experience", 
       x = '', y = '',
       fill = "Years of Experience") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        axis.text = element_text(face = 'bold'),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) +
  scale_fill_brewer(palette = 'Set1')
```

## Title

```{r rename4}
explore <- read_csv('output/job_listings.csv')
explore |> 
  group_by(website) |> 
  summarise(count = n())
```







------------------



##### Most Frequently Cited Skills

```{r}
jobs_long %>%
  group_by(skills) %>%
  summarize(citations = n(), .groups = 'keep') %>%
  arrange(desc(citations)) %>%
  head(20)

for (ed_level in unique(jobs_long$highest_ed)) {
  jobs_long %>%
    filter(highest_ed == ed_level) %>%
    group_by(skills) %>%
    summarize(citations = n(),
              ed_level = ed_level,
              .groups = 'keep') %>%
    arrange(desc(citations)) %>%
    head(10) %>%
    print()
}

for (loc in c('New York', 'Remote', 'France')) {
  jobs_long %>%
    filter(location == loc) %>%
    group_by(skills) %>%
    summarize(citations = n(),
              location = loc,
              .groups = 'keep') %>%
    arrange(desc(citations)) %>%
    head(10) %>%
    print()
}
```


Group the data by the skills column and count the number of counts for each skill:

```{r}
skill_counts <- jobs_long %>%
  group_by(skills) %>%
  summarize(counts = n(), .groups = 'keep')

```


Filter out any skills that you don't want to include in the plot

```{r}
overweighted <- c("data", "analyst", "analysis", "analytics","big data","business analytics", "data")
skill_counts <- skill_counts[!grepl(paste(overweighted, collapse="|"), skill_counts$skills), ]

```


Sort the data by the number of citations in descending order and select the top 50 most cited skills

```{r}
skill_counts <- skill_counts %>%
  arrange(desc(counts)) %>%
  head(50)

```



Create the plot using ggplot2 and ggwordcloud packages

```{r}
library(ggplot2)
library(ggwordcloud)

ggplot(skill_counts, aes(label = skills, size = counts, color = factor(sample.int(8, nrow(skill_counts), replace = TRUE)))) +
  geom_text_wordcloud() +
  scale_size_area(max_size = 10) +
  theme_minimal()

```

Most frequently counted skills for job listings with at least 5 years of experience

```{r}
exp5_skill_counts <- jobs_long %>%
  filter(years_exp >= 5) %>%
  group_by(skills) %>%
  summarize(counts = n(), .groups = 'keep')

ggplot(exp5_skill_counts, aes(label = skills, size = counts, color = factor(sample.int(8, nrow(exp5_skill_counts), replace = TRUE)))) +
  geom_text_wordcloud() +
  scale_size_area(max_size = 15) +
  theme_minimal()

```

The code is creating a word cloud of skills that are required for jobs with 5 or more years of experience. The jobs_long data frame is filtered to keep only the rows where the years_exp column is greater than or equal to 5, and then grouped by the skills column.


```{r}

# Plot a word cloud of the most frequently cited skills
skills_freq <- jobs_long %>%
  count(skills) %>%
  arrange(desc(n)) %>%
  head(100)
ggplot(skills_freq, aes(label = skills, size = n)) +
  geom_text_wordcloud() +
  theme_minimal() +
  labs(title = "Most frequently cited skills")

```
This code generates a word cloud plot of the most frequently cited skills in the jobs_long dataset. It first creates a new dataframe called skills_freq that counts the frequency of each skill in the skills column of jobs_long, arranges them in descending order, and selects the top 100. It then uses ggplot and geom_text_wordcloud to plot the skill names as words, with the size of the word indicating the frequency of the skill. The plot is given a title "Most frequently cited skills


##### Number of job listings per website

```{r}

distinct_job_website <- 
  jobs_long |> 
  group_by(website) |> 
  summarise(count = n_distinct(job_id))

# Plot a bar chart of the number of job listings per website
ggplot(distinct_job_website, aes(x = website, y = count)) +
  geom_bar(fill = "steelblue", stat = 'identity') +
  coord_flip() +
  labs(title = "Number of job listings per website",
       x = "Website", y = "Count")
```

# Resample 
```{r}

jobs_long |> 
  filter(is.na(location)) |> 
  group_by(website) |> 
  summarise(count = n_distinct(job_id))
```

```{r}


# Plot a stacked bar chart of the number of job listings by location and highest education level
ggplot(jobs_long, aes(x = highest_ed, fill = location)) +
  geom_bar() +
  labs(title = "Number of job listings by location and highest education level",
       x = "Highest education level", y = "Count") +
  theme(legend.position = "bottom")

```

The code is generating a stacked bar chart that shows the number of job listings for each combination of location and highest education level. The x-axis represents the highest education level and the bars are stacked by location. 



**What are the top 10 most important skills for data science?**

```{r}
job_listings <- read.csv(url("https://raw.githubusercontent.com/ShanaFarber/D607_Project3/main/output/job_listings.csv"), na.strings=c(""))
  
skills <- read.csv(url("https://raw.githubusercontent.com/ShanaFarber/D607_Project3/main/output/skills.csv"))

top_10 <- skills %>%
  count(skill) %>%
  arrange(desc(n)) %>%
  head(n = 10)

knitr::kable(top_10, col.names = c("Skills", "Frequency"), format.args = list(big.mark = ","))

top_10 %>%
  ggplot(aes(y = skill, x = n, fill = skill)) +
    geom_bar(stat = "identity") +
    labs(title = "Top 10 Skills for Data Science", x = "Frequency", y = "Skill") +
    theme(legend.position = "none")
```

**What are the top skills for Data Scientists vs. Data Analysts?**

```{r fig.show='hold', out.width='50%'}
# create a full data frame with the skills
full <- job_listings %>%
  right_join(skills, by="job_id")

# filter for just data scienctists and analysts
data_scientist <- full %>% 
  filter(str_detect(job_title, "Data Scientist")) %>%
  mutate(job = "Data Scientist")
  
data_analyst <- full %>% 
  filter(str_detect(job_title, "Data Analyst")) %>%
  mutate(job = "Data Analyst")

# top 10 for each
data_scientist_top10 <- data_scientist %>%
  count(skill) %>%
  arrange(desc(n)) %>%
  head(n = 10)

data_analyst_top10 <- data_analyst %>%
  count(skill) %>%
  arrange(desc(n)) %>%
  head(n = 10)

# plot top 10
data_scientist_top10 %>%
  ggplot(aes(y = skill, x = n, fill = skill)) +
    geom_bar(stat = "identity") +
    labs(title = "Top 10 Skills for Data Scienctists", x = "Frequency", y = "Skill") +
    theme(legend.position = "none")

data_analyst_top10 %>%
  ggplot(aes(y = skill, x = n, fill = skill)) +
    geom_bar(stat = "identity") +
    labs(title = "Top 10 Skills for Data Analysts", x = "Frequency", y = "Skill") +
    theme(legend.position = "none")
```


## conclusion 

The "Master" education level is the most prevalent among different job types, followed by "PhD" and "Bachelor".
The majority of jobs have a maximum salary value between 0 and 100,000 USD. There are relatively fewer jobs with a maximum salary value between 100,000 and 200,000 USD, and even fewer with a maximum salary value between 200,000 and 300,000 USD. There are only a few jobs with a maximum salary value above 300,000 USD.
There are differences in the distribution of years of experience across different job positions and education levels. For example, among individuals with a Bachelor's degree, the distribution of years of experience appears to be skewed towards the lower end, suggesting that many individuals in these positions have relatively little experience. On the other hand, among individuals with a PhD, the distribution of years of experience appears to be more evenly spread out, suggesting that individuals with a PhD may have more varied levels of experience.
The most frequently cited skills in the job listings are "Python", "SQL", and "Machine Learning". The top skills cited in the job listings vary depending on the highest education level required and the job location.

